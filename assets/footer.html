<!-- =========================================================
EPTEC FOOTER — HARMONY FINAL
========================================================= -->
<footer id="eptec-footer" class="eptec-footer">

  <div class="footer-inner">
    <span class="footer-brand">
      © <span id="footer-year"></span> EPTEC Business-Guard
    </span>

    <nav class="footer-links">
      <a id="link-imprint" href="javascript:void(0)">Imprint</a>
      <a id="link-terms" href="javascript:void(0)">Terms</a>
      <a id="link-support" href="javascript:void(0)">Support</a>
      <a id="link-privacy-footer" href="javascript:void(0)">Privacy</a>
    </nav>
  </div>

</footer>

<script>
(() => {
  "use strict";

  const $ = (id) => document.getElementById(id);
  const safe = (fn) => { try { return fn(); } catch {} };

  // -----------------------------
  // Static year
  // -----------------------------
  const y = $("footer-year");
  if (y) y.textContent = new Date().getFullYear();

  // -----------------------------
  // Texts (aligned with i18n keys)
  // -----------------------------
  const TXT = {
    en: {
      imprint: "Imprint",
      terms: "Terms",
      support: "Support",
      privacy: "Privacy"
    },
    de: {
      imprint: "Impressum",
      terms: "AGB",
      support: "Support",
      privacy: "Datenschutz"
    }
  };

  function getLang() {
    const S = window.EPTEC_UI_STATE;
    const s =
      safe(() => (typeof S?.get === "function" ? S.get() : null)) ||
      safe(() => S?.state) ||
      {};
    return String(s?.i18n?.lang || s?.lang || "en").toLowerCase() === "de"
      ? "de"
      : "en";
  }

  function applyText() {
    const l = getLang();
    const t = TXT[l] || TXT.en;

    if ($("link-imprint")) $("link-imprint").textContent = t.imprint;
    if ($("link-terms")) $("link-terms").textContent = t.terms;
    if ($("link-support")) $("link-support").textContent = t.support;
    if ($("link-privacy-footer")) $("link-privacy-footer").textContent = t.privacy;
  }

  // -----------------------------
  // Legal open (NO routing here)
  // -----------------------------
  function bindLegalLinks() {
    const open = (key) =>
      safe(() => window.EPTEC_UI?.openLegal?.(key));

    $("link-imprint")?.addEventListener("click", () => open("imprint"));
    $("link-terms")?.addEventListener("click", () => open("terms"));
    $("link-support")?.addEventListener("click", () => open("support"));
    $("link-privacy-footer")?.addEventListener("click", () => open("privacy"));
  }

  // -----------------------------
  // React to language change
  // -----------------------------
  function bindLangReactive() {
    const S = window.EPTEC_UI_STATE;
    if (typeof S?.subscribe === "function") {
      S.subscribe(applyText);
    } else if (typeof S?.onChange === "function") {
      S.onChange(applyText);
    }
  }

  // -----------------------------
  // Init
  // -----------------------------
  applyText();
  bindLegalLinks();
  bindLangReactive();

})();
</script>
